#!/bin/bash
set -e

echo "=== Updating system and installing essentials ==="
apt update && apt upgrade -y
apt install -y screen curl iptables build-essential git wget lz4 jq make gcc nano automake autoconf tmux htop nvme-cli libgbm1 pkg-config libssl-dev libleveldb-dev tar clang bsdmainutils ncdu unzip python3 python3-pip python3-venv python3-dev

echo "=== Installing Node.js 22.x and Yarn ==="
curl -fsSL https://deb.nodesource.com/setup_22.x | bash -
apt install -y nodejs
npm install -g yarn
curl -o- -L https://yarnpkg.com/install.sh | bash
export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
source ~/.bashrc

echo "=== Cloning RL-Swarm Repository ==="
if [ ! -d "rl-swarm" ]; then
    git clone https://github.com/gensyn-ai/rl-swarm/
fi

echo "=== Creating Python Virtual Environment ==="
cd rl-swarm
python3 -m venv .venv
source .venv/bin/activate

echo "=== Installing LocalTunnel ==="
npm install -g localtunnel

echo "=== Starting RL-Swarm ==="
chmod +x run_rl_swarm.sh
./run_rl_swarm.sh &

echo "=== Starting LocalTunnel on port 3000 ==="
lt --port 3000 &

echo "=== Setup Complete! ==="
echo "Available Models:"
echo "1) Gensyn/Qwen2.5-0.5B-Instruct"
echo "2) Qwen/Qwen3-0.6B"
echo "3) nvidia/AceInstruct-1.5B"
echo "4) dnotitia/Smoothie-Qwen3-1.7B"
echo "5) Gensyn/Qwen2.5-1.5B-Instruct"
